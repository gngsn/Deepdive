# CHAPTER 04. Service Level Objectives

<i>서비스 수준 목표</i>

이 장에서는 지표의 모델링, 선택, 분석 과정에서 발생하는 문제들을 해결하기 위해 사용했던 프레임워크를 소개

## Service Level Terminology / 서비스 수준 관련 용어

서비스 수준 지표(SLI)와 서비스 수준 목표(SLO)는 신중하게 정의해야 함
: 보통 서비스 수준 협약(SLA)이 문맥에 따라 의미가 달라지거나 여러 가지 의미를 가질 수 있기 때문

### 1. 척도

**SLI(Service Level Indicator, 서비스 수준 지표)**: 서비스 수준을 판단할 수 있는 여러 지표를 정량적으로 측정한 값

**예시**: 

- **가용성**: 중요한 SLI 중 하나. 올바른 형태의 요청이 성공적으로 처리된 비율. **수율**이라고도 함
  - _수율: 서버가 받은 요청 대비 성공적으로 응답한 비율을 의미함_
- 요청에 대한 응답 속도, 전체 요청 수 대비 오류율, 시스템 처리량 등
  - 측정된 값들은 일정 기간 동안 모아서 비율, 평균, 백분율 등을 계산할 수 있음
- 데이터 저장소 시스템에서는 **내구성** - _데이터의 오랜 시간 보관을 보장_ - 역시 중요한 지표


### 2. 목표

**SLO(서비스 수준 목표)**: SLI로 측정된 서비스 수준의 목표치 또는 일정 범위를 의미

SLO 는 `SLI <= 목표치` 또는 `최솟값 <= SLI <= 최댓값`으로 표현할 수 있음


### 3. 협약

**SLA(서비스 수준 협약)**: 서비스 수준 목표(SLO)를 달성했을 경우 or 달성하지 못했을 경우의 보상에 대한 사용자와의 명시적 또는 암묵적인 계약

**SLO와 SLA의 차이점**: 'SLO를 달성하지 못하면 어떻게 될 것인가?' 에 대한 명확한 결론이 없으면, 그 지표는 SLO일 가능성이 큼


## Indicators in Practice / 지표설정

### 정말 중요한 것?

- 모든 지표를 SLI로 취급할 필요는 없음
- 시스템의 상태를 평가하기에 부족함이 없는 적절한 수의 척도를 선택해야 함

- 예시
  - **저장소**: 응답 시간, 가용성, 내구성을 중시
  - **데이터처리 파이프 라인같은 빅데이터**: 처리량과 종단 간 응답 시간을 중시

### 척도 수집하기

많은 척도들은 기본적으로 **보그몬**(Borgmon)이나 **프로메테우스**(Prometheus) 같은 도구를 사용해 서버 측에서 수집됨

일부 시스템들은 **클라이언트 측**의 수집이 필요할 수 있는데, 
서버 지표에는 나타나지 않지만 사용자에게는 문제가 되는 부분을 놓칠 수 있기 때문

### 합산하기

대부분의 지표는 평균보다는 **분포(distribution)**가 더 중요

예를 들어, 응답 시간 SLI의 경우 일부 요청은 빠르게 처리되었지만, 나머지는 균일하게 더 느리게 처리될 수 있음

### 척도의 표준화

각각의 척도들에 대해 최우선 원칙을 표준화함으로써, SLJ(서비스 수준 지표)들에 대한 정의를 표준화하는 것을 권장

예시: 집계 간격, 집계 범위, 측정 빈도, 데이터 수집 방식, 데이터 액세스 응답 시간 등

이처럼 모든 범용 지표에 대해 재사용 가능한 SLI 템플릿을 설정해두면 많은 노력을 절감할 수 있음


예)

- 집계 간격: '평균1분'
- 집계 범위: '하나의 클러스터에서 수행되는 모든 태스크들'
- 측정 빈도: '매10초'
- 집계에 포함할 요청들: '블랙 박스 모니터링 잡이 수집한 HTTP GET 요청들
- 데이터 수집 방식: '모니터링 시스템에 의해 서버에서 수집'
- 데이터 액세스 응답 시간: '데이터의 마지막 바이트가 전송된 시간'

범용 지표에 대해 재사용 가능한 SLI 템플릿을 설정 해두면 많은 노력을 절감할 수 있음


## Objectives in Practice / 목표 설정에 대한 실습

목표 설정의 목적은 사용자가 중요하게 생각하는 것이 무엇인지 찾아내는 것

### 목표치 선택하기

**1. 현재 성능을 기준으로 목표치를 설정하지 말 것**

현재 시스템의 장점과 한계를 이해하는 것이 중요

현재 성능을 기준으로 목표치를 설정하면, 시스템에 지나치게 많은 노력을 투입하게 되고, 재설계 없이는 향상이 어려울 수 있음


**2. 최대한 단순하게 생각할 것**

SLI를 복잡하게 집계하면 시스템의 성능 변화가 명확하게 반영되지 않으며 원인 분석이 어려워질 수 있음


**3. 자기 만족에 얽매이지 말 것**

응답 시간을 무한정 줄이는 것은 매력적일 수 있지만 현실적이지 않음

이러한 목표를 실현하려면 많은 시간과 비용이 필요 + 사용자가 실제로 만족할 수 있는 수준을 초과할 가능성이 큼

**4. 가능한 적은 수의 SLO를 설정할 것**

시스템의 특성을 잘 반영할 수 있는 최소한의 SLO를 선택해야 함

사용자의 만족을 정의하는 것이나 모든 특성을 SLO로 설정하기는 어려움


**5. 처음부터 완벽하게 하려고 하지 말 것**

SLO의 정의와 목표는 시간이 지나면서 시스템의 동작을 살펴보며 다시 정의할 수 있음

처음에는 느슨한 목표를 설정하고 점진적으로 강화하는 것이 좋음


### 측정하기

SLI와 SLO는 시스템을 관리하는 **제어 루프(Control Loop)**의 핵심 요소

1. SLI를 모니터링하고 측정하기
2. SLI를 SLO와 비교하여 별도의 대응이 필요한지 판단하기
3. 대응이 필요할 경우, 목표치를 달성하기 위해 어떻게 대응할지 파악하기
4. 대응하기


### SLO 는 기대치를 설정하는 것

SLO를 공개한다는 것은 시스템의 동작에 대한 기대치를 설정하는 것

- **안전 제한선을 지킬 것**
  - 사용자에게 광고한 SLO보다는 내부적으로 더 보수적으로 설정된 SLO를 지키면 만성적으로 발생하는 문제들이 외부로 노출되기 전에 적절하게 대응할 수 있는 여력을 가질수 있음
- **지나친목표를설정하지말것**

## Agreements in Practice

SLA를 설정하려면 사업 부서와 법무 팀이 위반 시 적절한 보상과 대가를 설정해야 함

SRE의 역할은 SLA에 명시된 SLO를 달성하도록 지원하며, 어려움과 가능성을 이해하도록 돕는 것

SLO 수립에 대한 조언의 대부분은 SLA에도 그대로 적용될 수 있음

**사용자에게 공개하는 내용은 보수적으로 설정하는 것이 좋음**



<br/><br/>
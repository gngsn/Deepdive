# CHAPTER 14. Managing Incidents

<small><i>장애 관리하기</i></small>

**장애 관리의 핵심** 
- 장애로 인한 피해 최소화 
- 최대한 빨리 평소의 비즈니스 운영 복구

장애 대처 방안을 사전 훈련을 수행하지 않으면 실제 상황에서는 의미없음

## Unmanaged Incidents

**예시: 가상의 회사의 비상대기 엔지니어인 메리가 되었다고 가정**

**상황:**
- 블랙박스 모니터링 시스템이 서비스가 중단
- 데이터센터에 유입되는 어떤 요청에도 응답할 수 없는 상태
- 남은 데이터센터에 평소보다 더 많은 트래픽이 몰려, 초과된 네트워크 부하로 인해 상황이 급속도로 나빠짐
- 오류 확인: 최근 수정 모듈 중 하나에서 에러가 발생하고 있음
- 이전 버전의 릴리즈로 되돌리기로 결정
- 문제가 된 서버 코드의 대부분을 작성한 개발자 조세핀 호출
- 조세핀의 트러블 슈팅 시작
- 조세핀의 동료인 사브리나와 로빈도 함께 터미널을 통해 접속
- 이때, 남은 데이터센터들도 완전히 동작을 멈춤
- 메리의 지인인 **말콤**에게 도움 요청
- 프로덕션 환경에 작은 변경만 적용하면 남은 서버 프로세스들을 최적화할 수 있을 것으로 판단하고 적용. 
- 몇 초가 지나자 서버들이 재시작됐고 변경 사항을 인식했지만 곧 다시 죽어버림

## 미흡한 장애 처리에 대한 자세한 분석

각자 자신들의 업무를 수행했음에도 문제가 많았음

- **문제1. 기술적인 문제에 대한 날카로운 집중**
  - 메리는 기술적인 작업이 너무 많았기 때문에 문제를 해소할 수 있는 큰 그림에 대해 생각할 수 있는 위치가 아님
- **문제2. 소통의 부재**
  - 자신들의 동료들이 어떤 일을 하고 있는지 아무도 모름 
  - 디버깅이나 이슈의 해결을 도와줄 법한 다른 엔지니어들을 효과적으로 활용하지 못함
- **문제3. 프리랜서의 고용**
  - 말콤 역시 자기가 최선이라고 생각하는 방향으로 시스템을 변경 
  - 다른 동료들은 물론 현재 장애 조치의 책임을 맡고 있는 메리와도 협업하지 않았음

## 장애 관리 절차의 기본 요소들

- 장애 관리 기술과 기량은 열정적인 개인의 에너지를 연결하기 위해 존재
- 구글의 장애 관리 시스템은 장애 제어 시스템(Incident Command System)을 기반
- 이 시스템의 명확성과 확장성은 정평이 남

### 책임에 대한 재귀적인 분리

- 장애 조치에 참여 중인 모든 사람들이 **자신의 역할을 명확히 이해**하고 **다른 이의 영역을 침범하지 않도록 하는 것**이 가장 중요
  - 책임에 대한 명확한 분리 → 개개인의 자율성 보장
  - 만일 누군가의 업무 부하가 감당하기 힘들 정도로 높아지면 그 사람은 계획을 수립하는 리더에게 더 많은 지원 인력 요청
- 이를 보장한 상태에서, 자신의 업무를 **보충된 인력에게 분산**

#### ✔️ 장애 제어
- 장애 제어자(incident commander)는 장애에 대한 높은 수준의 상태 확인
- 이후, 장애 조치를 위한 팀 구성하고 필요와 우선순위에 따라 책임 나누어줌
- 사실상, 이 제어자는 다른 사람에게 위임되지 않은 모든 역할 수행
- 필요하다면 운영팀이 효율적으로 업무를 수행하는 데 있어 방해가 되는 요소는 모두 해소해주어야 함

#### ✔️ 운영 업무
Ops 조직 리드는 장애 제어자와 협력하여 운영 도구를 이용해 실제 업무 수행으로 장애에 대처
장애를 조치하는 동안에는 오직 운영팀만이 시스템 변경 가능

#### ✔️ 의사소통
이 인력은 장애 조치 팀 외부 창구
가장 큰 역할은 장애 대응팀 현황을 정기적으로 의사결정자들에게(주로 이메일 통해) 전달하는 것
장애 조치 문서를 최신 상태로 유지하는 역할도 겸해서 수행 가능

#### ✔️ 계획
계획 업무 담당자는 운영팀 도와 버그를 수집하거나, 저녁 식사를 주문하거나, 업무 분쟁 돕거나,
시스템이 원래 상태에서 어떻게 변경되는지를 추적한 후 장애가 조치된 후 이를 원래대로 복구하는 등 좀 더 장기적인 이슈들 처리

### 확실한 컨트롤타워

장애 조치에 참여 중인 사람들은 장애 제어자와 어떻게 소통해야 하는지 명확히 이해
장애 조치 팀원들은 소위 '전쟁터(War Room)'로 활용할 목적으로 만들어진 공간에 함께 있는 것이 좋다

본래 각자의 위치에서 일하기를 원할 수도 있지만 이 경우 이메일이나 IRC 등으로 장애에 대한 상황 지속 통보 받아야 함

구글은 장애 조치에 IRC가 큰 도움이 됨을 깨달았다. IRC는 신뢰성이 높고 장애에 대한 의사소통 로그로도 사용 가능, 이런 기록은 지금까지 변경한 내용 기억하는 데 큰 도움 됨

### 실시간 장애 조치 문서

장애 제어자의 가장 중요한 역할 중 하나는 장애 조치 문서를 실시간으로 관리하는 것

위키에 생성 가능하지만, 이상적으로는 누구든지 동시에 편집 가능

### 명확하고 즉각적인 업무 이관

장애 제어자의 일과 끝나면 다른 누군가에게 명확하게 이관하는 것은 기본 중 기본

새로운 장애 제어자가 완전히 업무 인수 받으면 인수자는 "이제 당신이 장애 제어자입니다. 알겠죠?"와 같이 명확하게 업무 이관하고 회사 전체가 이 업무의 이관에 대해 인지할 때까지 연락 끊어서는 안 됨

## 적절하게 관리한 장애 조치

원리들 잘 준수할 경우

장애 발생 동일 ...
메리는 장애 관리 프레임워크 구조 따르는 것이 좋겠다고 생각

#### ✔️ 메리 → 사브리나

메리는 재빨리 사브리나에게 물었다. "장애 제어 맡아줄래요?"

메리에게서 지금까지 어떤 일 일어났는지 대해 간략하게 보고

보고 내용 이메일 통해 미리 정해둔 메일 수신자들에게 전달

메리는 "아직 사용자들에게 영향 없음; 세 번째 데이터센터에도 같은 증상 발생하지 않기를 바라고 있음" 회신

사브리나는 해당 알림을 IRC 디버깅 채널에서 발견하고 이메일 스레드 재빨리 업데이트

이메일 스레드 덕분에 부사장들도 실무자들을 괴롭히지 않고도 장애 대한 즉각적인 보고 받음

#### ✔️ 사브리나 → 외부 소통 담당자

사브리나는 외부 소통 담당자에게 사용자들에게 보낼 메시지 작성 요청

#### ✔️ 사브리나 → 조세핀

조세핀을 메일 수신자 목록에 추가

#### ✔️ 로빈 투입

조세핀이 로그인 시점에 로빈은 이미 자원해서 장애 조치에 합류

로빈과 조세핀은 장애 문서를 통해 현재 상태 신속하게 파악

메리는 이전 버전 바이너리 다시 릴리즈해봤지만 문제 해결되지 않았음 인지

조세핀은 IRC 채널에 시도했던 방법으로 문제 해결되지 않았음 통보

사브리나는 자신과 동료가 퇴근할 시간 다가오자 이 장애 대신 처리할 다른 동료 찾기 위해 장애 조치 문서 업데이트

문제 해결한 후 장애 조치 완료하고 포스트모텀 작성 시작

## 언제 장애 선언할 것인가?

다음 중 어느 한 조건이라도 해당된다면 이를 장애라고 판명

- 문제를 해결하기 위해 다른 팀의 도움 필요한가?
- 문제가 사용자에게 영향 미쳤는가?
- 문제 발생 이후 한 시간 동안 집중적으로 분석했는데도 문제 해결되지 않았는가?

장애 관리에 대한 숙련도 계속 활용하지 않으면 실사리 쇠퇴

## 요약

- 장애 관리 전략 사전에 수립하고,
- 이 전략을 잘 운영하고, 
- 이 전략을 자주 되풀이해서 수행할 수 있도록 하면, 
- 장애 시 복구 시간과 직원들이 긴급한 문제 해결하는 데 받는 스트레스를 확실히 줄일 수 있다는 점

**장애 조치에 대한 모범 사례**

- **우선순위**: 우선 출혈 막고 서비스 되살린 후 근본 원인 대한 증거 찾자.
- **사전 준비**: 장애 조치에 참여한 사람들의 자문받아 장애 관리 절차 미리 개발하고 문서화해두자.
- **신뢰**: 장애 조치에 참여 중인 모든 사람들에게 충분한 자율권 보장하자.
- **감정 조절**: 장애 조치하는 동안 스스로 감정적 상태 주의하자. 너무 부담 되면 다른 이에게 도움 청하자.
- **대체 방안에 대한 모색**: 주기적으로 현재 선택할 수 있는 방법 대해 다시 생각하고 이 방법이 여전히 유효한지, 아니면 다른 방법 찾아야 하는지 판단하자.
- **실습**: 이 과정을 정기적으로 수행해서 자연스럽게 활용할 수 있는 수준으로 만들자.
- **개선**: 그리고 계속해서 개선하자. 모든 팀 구성원들이 모든 역할에 익숙해질 수 있도록 독려하자.


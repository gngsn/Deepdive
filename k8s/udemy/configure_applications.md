## Configure Applications

### Environment Variables 

이번 강의에서는 쿠버네티스의 환경 변수를 설정하는 법을 알아보도록 하죠

지난 강의에서 도커 명령과 같은 이미지를 사용하는 포드 정의 파일을 받았죠

환경 변수를 설정하려면 ENV 속성을 사용하세요

ENV는 배열입니다 ENV 속성 하의 모든 항목은 배열의 항목을 나타내는 대시부터 시작하죠

물건마다 이름과 가치가 있어요

이름은 환경 변수의 이름이에요 컨테이너와 함께 사용 가능하게 된 거죠 값은 그 값이에요

방금 본 건 평상 키 값 연동 포맷을 이용해 환경 변수를 지정하는 직접적인 방법이었죠

하지만 환경 변수를 설정하는 다른 방법도 있어요 구성 맵과 비밀 사용 같은 거요

이 경우의 차이점은 값을 지정하는 대신 값을 from이라고 하고 구성 맵이나 비밀의 사양이라고 하죠

구성 지도와 비밀 열쇠에 관해선 다음 강의에서 논의하죠


---

### ConfigMaps

포드 정의 파일이 많을 경우 쿼리 파일에 저장된 환경을 관리하기가 어려워지죠

포드 정의 파일에서 이 정보를 갖고 와 구성 지도를 이용해 중앙에서 관리할 수 있죠

구성 맵은 쿠버네테스의 키 값 쌍의 구성 데이터를 전달하는 데 사용되죠

포드가 생성되면 포드에 구성 지도를 삽입해 키 값 쌍이 환경 변수로 사용될 수 있게 합니다

포드의 컨테이너 안에 호스팅된 응용 프로그램을 위해서요

구성 맵 구성에는 두 단계가 있어요

첫째, 구성 맵을 생성하고 둘째, 그걸 포드에 주입해요

다른 쿠베르네테스 개체와 마찬가지로 구성 지도를 만드는 방법은 두 가지죠

이건 config map definition 파일을 쓰지 않고 명령적인 방법이고 명령적인 방법은 config

map definition 파일을 이용하는 거죠

구성 맵 정의 파일을 만들고 싶지 않다면 그냥 Kube 컨트롤을 이용해 구성 맵

명령을 만들고 필요한 인수를 명시하세요

이 방법으로 명령줄에서 키 반환 쌍을 직접 지정할 수 있어요

주어진 값의 구성 지도를 만들려면 Kube 컨트롤을 실행해 구성 지도 만들기를 명령하세요

명령 다음에 구성 이름과 리터럴로부터 옵션이 따르죠

프롬 리터럴 옵션은 명령 자체에서 키 값 쌍을 지정하는 데 사용되죠

이 예제에선 앱 구성이란 이름으로 구성 맵을 생성합니다

앱 색상 키 값 쌍은 파란색이고요

추가 키 값 쌍을 추가하고 싶다면 간단히 FROM 리터럴 옵션을 여러 번 지정하세요

하지만 구성 항목이 너무 많으면 좀 복잡해져요

구성 데이터를 입력하는 또 다른 방법은 파일을 통해서죠

파일 옵션을 이용해 필요한 데이터를 포함하는 파일로의 경로를 지정하세요

이 파일의 데이터를 읽고 파일 이름으로 저장하죠

이제 선언적 접근을 살펴보죠

이것을 위해 definition 파일을 생성합니다 포드에 했던 것처럼요

파일은 형식 변환, 메타데이터를 갖고 있고 스펙 대신 데이터가 있어요

APiVersion은 V1이고 config map이에요

메타데이터 아래에 구성 맵의 이름을 명시해요

앱 구성이라고 부를게요

구성 데이터 아래 키 값 포맷으로요

큐브 컨트롤을 실행하고 명령을 생성하고 구성 파일 이름을 지정하세요

그게 우리가 지정하는 값으로 구성 매핑을 만들어요

필요한 만큼 구성 맵을 만들 수 있어요 다양한 목적으로 같은 방식으로요

애플리케이션 하나는 SQO용이고 다른 하나는 Redis용이에요

그래서 구성 맵에 이름을 적절히 붙이는 게 중요합니다

나중에 이 이름을 사용하면서 포드와 연관시킬 테니까요

구성 맵을 보려면 Kube 컨트롤 Get 구성 맵 명령을 실행하세요

앱 구성으로 명명된 새로 생성된 구성 맵의 나열이죠

구성 맵을 설명하는 명령은 구성 데이터를 데이터 섹션 아래에 나열하죠

이제 구성 맵이 생성됐으니 포드와 그걸 구성하는 2단계로 넘어가죠

여기 간단한 웹 응용 프로그램을 실행하는 간단한 포드 정의 파일이 있어요

환경 변수를 삽입하려면 ENV from이라는 컨테이너에 새 속성을 추가하세요

부동산 쪽 ENV는 목록이에요

그래서 필요한 만큼 환경 변수를 통과할 수 있죠

목록의 각 항목은 구성 지도 항목과 일치해요

앞서 만든 구성 지도의 이름을 명시하세요

전에 만든 것에서 특정 구성 지도를 삽입하는 방법이죠

포드 정의 파일을 만드는 건 이제 파란 배경의 웹 응용 프로그램을 만들어요

방금 보신 건 환경 변수를 넣기 위해 구성 맵을 사용하는 거였죠

구성 데이터를 포드에 넣는 다른 방법도 있어요

단일 환경 변수로 넣을 수도 있고 전체 데이터를 파일로 볼륨에 넣을 수도 있어요

이번 강의에 수반되는 코딩 과제에서 이 중 몇 가지를 살펴볼게요


---

### Secrets

여기 간단한 Python 웹 응용 프로그램이 있는데요

M I. Q. L 데이터베이스에 연결되어 있죠

성공적인 애플리케이션은 성공적인 메시지를 보여주죠

코드를 자세히 보시면 호스트 이름, 사용자 이름, 암호 파트 코드가 있어요

이건 좋은 생각이 아니에요

지난 강의에서 배웠듯이 한 가지 옵션은 이런 값들을 구성 문구로 옮기는 거죠

ConfigMap은 일반 텍스트 형식으로 구성 데이터를 저장하죠

호스트 이름과 사용자 이름을 구성 맵으로 옮기는 건 괜찮지만 암호를 저장할 곳은 아니죠

여기서 비밀이 등장하죠

비밀은 비밀번호나 열쇠 같은 민감한 정보를 저장하는 데 쓰이죠

인코딩된 형식으로 저장된다는 점만 빼면 ConfigMaps와 비슷해요

ConfigMaps와 마찬가지로 비밀 작업에는 두 단계가 있어요

첫째, 시크릿을 생성하고 둘째, 포드에 주입해요

비밀을 만드는 방법은 두 가지입니다 명령적인 방법은 비밀 정의 파일을 쓰지 않는 거죠

명령적인 방법은 비밀 정의 파일을 이용해 명령적

방법으로요 명령줄에서 키 값 쌍을 직접 지정할 수 있어요

주어진 값의 암호를 생성하려면 k벡틀을 실행하고 암호 생성, 일반 명령이요

명령 뒤엔 비밀 이름과 문자 그대로의 옵션이 따르죠

프롬 리터럴 옵션은 명령 자체에서 키 값 쌍을 지정하는 데 사용되죠

이 예제에선 키값 쌍 DB_host=MySQL로 이름에 따른 암호를 앱 암호로 만들고 있어요

추가 키 값 쌍을 추가하고 싶다면 FROM 리터럴 옵션을 여러 번 지정하세요

하지만 비밀이 너무 많으면 일이 복잡해질 수 있죠

기밀 데이터를 입력하는 또 다른 방법은 파일을 통해서죠

프런트 파일 옵션을 이용해 필요한 데이터를 포함하는 파일의 경로를 지정하세요

이 파일의 데이터를 읽고 파일 이름으로 저장하죠

이제 선언적 접근을 살펴보죠

이것을 위해 definition 파일을 생성합니다 ConfigMap에서 했던 것처럼요

파일은 API 버전, 유형 메타데이터와 데이터를 갖고 있어요

API 버전은 V1이고 유사품은 비밀이죠

메타데이터 아래에 비밀의 이름을 명시하세요

앱 비밀이라고 부를게요 데이터 아래에 키 값 형식으로 비밀 데이터를 추가하세요

하지만 비밀에 대해 논의했던 한 가지는 민감한 데이터를 저장하기 위해 사용되고 암호화된 포맷으로 저장된다는 거죠

데이터를 일반 텍스트로 명시했는데 아주 안전하진 않죠

명령적 접근으로 비밀을 만드는 동안 인코딩된 형식의 비밀 값을 지정해야 하죠

이렇게 인코딩된 형식으로 데이터를 지정해야 해요

하지만 일반 텍스트에서 인코딩된 형식으로 데이터를 어떻게 변환할까요?

Linux 호스트에서 커맨드 echo-n을 실행하면 여러분이 변환하려는 텍스트가 나옵니다

이 경우엔 제 SQL이죠

베이스 64 유틸리티에 연결해요

기밀을 보려면 큐벡틀 기밀 확보 명령을 실행해요

새로 개발한 비밀과 함께 쿠버네츠가 내부 목적으로 개발한 또 다른 비밀도 나열돼 있죠

새로 만들어진 비밀 장치인 큐벡틀에 대한 정보를 더 보시려면 비밀 명령을 설명해 주세요

비밀의 속성은 드러났지만 그 자체는 가치를 감췄죠

값도 보고요 kbectl을 실행해 비밀 명령을 확보하세요

YAML 포맷에 표시된 결과와 함께요 O 옵션을 사용해서요

손으로 코딩한 값도 보이실 거예요 암호화된 값은 어떻게 해독하죠?

이전에 인코딩에 사용했던 base64 커맨드를 이용합니다

이번에는 디코딩 옵션을 추가하세요

이제 시크릿을 생성했으니 2단계로 넘어가죠 포드로 구성하는 거예요

여기 응용 프로그램을 실행하는 간단한 포드 정의 파일이 있어요

환경 변수를 삽입하려면 ENV from이라는 컨테이너에 새 속성을 추가하세요

ENV FROM 속성은 목록으로 필요한 만큼 많은 환경 변수를 넘길 수 있죠

목록의 각 항목은 비밀 항목과 일치합니다 아까 만든 비밀의 이름을 명시하세요

포드 정의 파일을 생성하면 비밀에 있는 데이터를 응용 프로그램의 환경 변수로 사용할 수 있게 되죠

방금 본 건 포드에 환경 변수로 비밀을 주입한 거예요

포드에 비밀을 주입하는 다른 방법도 있어요

단일 환경 변수로 넣을 수도 있고 파일로서 전체 비밀을 볼륨에 넣을 수도 있어요

포드에 음량으로 비밀을 담는 거죠

비밀의 각각의 특성은 파일로 생성됩니다 비밀의 값을 콘텐츠로서요 이 경우엔 비밀 3개 파일에 3가지 속성이

있기 때문에 DB 암호 파일의 내용을 보면 그 안에 암호가 있어요

비밀을 다룰 땐 주의할 점이 있어요

우선, 비밀은 암호화되어 있지 않아요

암호화되어 있기 때문에 누구든 기밀문서로

만든 파일을 볼 수 있고 기밀개체를 얻을 수 있습니다. 그리고

전에 이야기 했던 방법으로

기밀 데이터를 볼 수 있죠.

그러니 GitHub나 그런 걸로 푸시할 때

비밀 정의 파일을 코드와 함께 체크인하지 마세요

GitHub에는 이미 많은 리포지토리가

있어요 사용자가 비밀 개체를 코드와 함께 밀어 넣은

거죠 나머지 코드와 함께요

중요한 건 그런 비밀 개체를 쉽게 얻을 수 있다는

겁니다 그걸 읽어 그런 다음 방금 논의한

기본 64 옵션을 이용해 디코딩하는 거죠

기본 암호가 뭔지 알 수 있어요

그러니 명심하세요

비밀은 부호화로 암호화되어 있지 않아요

idcd의 어떤 데이터도 기본값으로 암호화되어 있지 않아요

따라서 휴식을 취할 때 암호화를 사용하는 걸 고려하세요 

관련 문서가 있군요

이건 비밀 데이터 암호화에 관한 문서예요 암호 구성이라는 걸 사용하죠

이건 여러분이 반드시 생성해야 하는 개체입니다

여러분은 kube-apiserver에 옵션으로 이걸 통과시킬 수 있어요

암호화 구성 파일을 만들어 통과시키는 거죠

기본적으로 여기서 특정 리소스를 대상으로 할 수 있어요

시크릿만 암호화하고 싶다면 이렇게 넘겨서 base64 인코딩된 객체를 제공하면 됩니다. 시크릿을 암호화하는 데 사용되는 것이죠.

네, 이 과정 전체의 데모를 녹화해서 비디오로 추가할게요 지금 여기서 찾고 있어요

또한 동명 공간에서 포드를 만들거나 배포를 할 수 있는 사람은 누구나 기밀에 접근할 수 있죠

그래서 일단 특정 네임스페이스에 비밀을 만들면 누구든 포드를 만들 권한이 있거나 같은 네임스페이스에서 배포를 할 수 있는 사람이 들어가서 포드나 배포를 만들고 같은 비밀을 사용하면 그 포드에 탑재된 비밀 물체를 볼 수 있는 거죠

그러니 역할 기반 액세스 제어를 구성해 액세스 제한을 고려하세요

끝으로 서드파티 암호 공급자를 고려하세요

AWS 공급자, Azure 공급자 GCP 공급자, 볼트 공급자 같은 거죠

이런 식으로 비밀은 Etcd가 아니라 외부 비밀 공급자에 저장되고 공급자는 보안의 대부분을 처리하죠

그런 걸 구성하는 게 이 과정의 고급 토픽입니다

쿠버네테스 보안 전문가 과정에서 논의하도록 하죠


## Factory Method Pattern

<small>| **한 줄 소개** | 알고리즘의 구조를 메소드에 정의하고, 하위 클래스에서 알고리즘 구조의 변경없이 알고리즘을 재정의 하는 패턴 </small>

<br/>

템플릿 메서드 패턴은 메서드를 이용해 각 단계를 템플릿 구조화하고 행동을 구분함

<br/>

## 22.1 프로그램의 구조

시작을 기준으로 하여 순차적으로(단계적으로 코드를 따라감) 코드를 읽고 해석함

<br/>

### 22.1.1 코드 실행 순서 분석

모든 행동에는 순서가 있으며, 우리가 무의식적으로 걸을때도 동작에 순서가 있음.

프로그램은 이러한 동작을 분석해 순차적으로 연결

<br/>

### 22.1.2 단계

실제 코딩으로 어떤 기능을 제작하려면 보다 상ㅅ세하고 구체적인 동작으로 기술해야 함

공작 처리 과정을 면밀하게 살펴보면 단계별로 구분할 수 있음.

프로그래밍은 복잡한 동작을 단계 별로, 구체적으로 구분하여 나열하는 것

컴퓨터는 동작을 하나씩 지정해서 실행해야 하므로 컴퓨터 프로그램을 바르게 작성하는 것은 각각의 단계를 잘 구별하는 것이라고 할 수 있음

<br/>

## 22.2 템플릿

샌드위치를 만든다고 해보자. 샌드위치는 빵 두개 사이에 속재료를 넣어서 만들어낼 수 있다.

이 것을 시스템으로 제작한다고 한다고 하면 어떻게 할까?

*빵을 놓는 코드 > 속재료를 넣는하는 코드 > 빵을 놓는 코드*

로 코드를 짤 것임. 

모든 샌드위치는 공통된 모양의 형틀을 갖고 있고 샌드위치를 만드는 원리와 만들어진 모습이 같음

내용물만 다를 뿐 제작하는 과정을 동일함.

<br/>

### 22.2.1 공통 로직

샌드위치의 종류는 다양하지만, 제작하는 과정을 동일하기 때문에 공통된 특징을 적용해 샌드위치 생성 과정을 단계별로 분리할 수 있음

```java
MakeSandwich()

1 단계. Bread()
2 단계. Jam()
3 단계. Bread()
```

<br/>

### 22.2.2 템플릿

템플릿Template에는 ‘형판’, ‘견본’이라는 뜻이 있으며, 객체지향에서의 템플릿은 공통된 처리 로직을 말함

이렇게 공통된 단계적 처리를 템플릿이라고 함

<br/>

## 22.3 일반화

클래스의 일반화는generalization는 공통점을 찾아 상위클래스로 도출하는 과정.

<br/>

### 22.3.1 클래스 분리

일반화는 객체지향의 상속을 구현하기 위해 공통된 부분을 찾는 과정.

공통된 템플릿 로직을 분리하는 이유는 중복된 코드가 발생하기 때문

일반화는 공통괸 부분과 다른 부분을 분리함

다양한 클래스로 객체를 확장할 때 공통된 부분만 모아서 별도로 관리하면 추후 유지 보수하기가 편함

공통된 부분은 상위 클래스로, 다른 클래스 하위 클래스로 재설계함

<br/>

### 22.3.2 접근 속성

일반화를 통해 공통된 로직을 상위 클래스로 분리. 공통되지 않은 부분은 하위 클래스에 위임.

상위 클래스의 템플릿 메서드는 하위 클래스의 메서드를 호출하여 사용함

템플릿 메서드에서는 불필요한 접근을 제한하고 템플릿 접근만 허용함

하위 클래스는 상위 클래스를 상속받으므로 외부에서 불필요한 메서드가 접근하는 것을 제한함

하위 클래스의 메서드 속성은 상속된 구조에서만 접근을 허용하는 `protected` 를 부여하여 설계

<br/>

### 22.3.3 일반화 결과

일반화를 통해 분리한 클래스는 코드 중복이 발생하지 않도록 구조를 개선한 효과를 얻을 수 있음

일반화로 분리된 클래스는 상속을 통해 결합함

<br/>

## 22.4 추상화

템플릿 메서드 패턴은 추상 클래스의 특징을 잘 활용하여 적용한 디자인 패턴

<br/>

### 22.4.1 오버라이드

<br/>

### 22.4.2 추상 클래스

상속을 통한 오버라이드를 하게되면 불필요한 메서드만 남을 수 있음

<br/>

### 22.4.3 상위 클래스

템플릿 메서드 패턴은 추상 클래스를 통해 상속을 추상화함

상위 클래스의 추상화는 외형적인 뼈대만 결정 또한 하위 클래스를 구현하는 기준

메서드는 상위 클래스에 공통적 기능만 구현하고, 변경되는 부분은 추상 메서드로 선언함

변경할 부분을 추상 메서드로 선언하는 이유는 상속받을 때 하위 클래스에서 중복적으로 재구현되기 때문임

추상 클래스를 상속한 하위 클래스에서도 일반화된 공통 로직을 호출하여 사용할 수 있음. 공통된 코드를 상위 클래스로 옮길 경우 추후에 효율적으로 유지 보수할 수 있음

<br/>

### 22.4.4 추상 메서드

템플릿 메서드 패턴은 2개의 클래스를 갖고 있는데, 템플릿의 메서드를 정의하는 추상클래스고 하나는 템플릿 구현부인 일반 클래스임

또한 두 개의 클래스는 서로 밀접한 관계를 갖고 있음

두 클래스의 관계는 추상 메서드의 선언을 통해 분리됨

<br/>

### 22.4.5 하위 클래스

실제 동작은 하위 클래스에서 처리하며 하위 클래스는 일반적인 클래스임

상위 클래스의 역할은 골격을 정의하는 것이고 하위 클래스의 역할은 골격의 실제 수행을 처리하는 것임

템플릿 메서드 패턴을 설계할 때 중요한 부분은 상위 클래스와 하위 클래스의 역할을 분배하는 것임

<br/>

### 22.4.6 추상화 결과

추상화하면 다수의 하위 클래스로 다양한 동작을 분리할 수 잇고 중복된 코드도 제거할 수 있음 

또한 필요에 따라 처리하는 동작을 그룹별로 생성할 수 있음

<br/>

### 22.4.7 `Final` 키워드

템플릿 메서드는 기능의 구조를 템플릿에 미리 정의함

템플릿은 공통된 기능으로 하위 클래스에서 오버라이딩되지 않도록 방지해야함 

상속 구조에서 `final` 키워드를 사용하면 메서드의 오버라이딩을 방지할 수 있음

<br/>

## 22.5 템플릿 메서드

템플릿 메서드는 공통된 로직을 분리하여 캡슐화함. 공통 단계인 템플릿을 별도의 메서드로 작성함

<br/>

### 22.5.1 로직 변경

템플릿 메서드는 공통된 알고리즘을 정의하며, 공통된 로직을 처리하는 행동

템플릿 메서드 패턴은 로직의 전페 구조를 변경하지 않고 일부분만 수정할 때 유용함

큰 틀에서 보면 비슷한 로직이지만, 미세한 차이로 인해 코드를 중복 작성하는 경우가 많음

중복된 코드는 유지 보수를 어렵게 만드는 원인이 됨

<br/>

### 22.5.2 분할과 협력

<br/>

### 22.5.3 후크

하위 클래스에서 구현되는 메서드를 후크Hook 메서드, `primitive` 메서드라고 함

후크는 중복된 코드를 제거하고 처리 로직의 일부를 변경할 때 자주 사용하는 기법

후크기능? 추상 클래스를 통해 호출 방식을 미리 정의하고 하위 클래스에서 실체를 구현하것이 후크 기능과 유사

상속으로 후크를 구현할 때는 오버라이드를 사용하며, 오바라이드는 기존의 메서드를 남겨둔 채 중복된 메서드를 새로 추가함. 하지만 추상 클래스로 후크를 처리할 때는 재정의가 아닌 미정의된 메서드를 신규로 구현함

<br/>

### 22.5.4 장점

클래스 일부를 외부에 노출하고, 외부에 노출된 메서드는 다른 객체에서 접근해 사용할 수 있음. 외부 접근을 허용함으로써 코드의 중복을 줄이는 효과를 얻을 수 있음

공통된 메서드를 노출함으로써 처리 로직을 한 곳에 집중함. 템플릿 메서드는 코드를 분산하지 않고 집중화하므로 변경이 용이

<br/>

## 22.6 의존성 디자인

구성 요소 간 상호 의존성이 발생

<br/>

### 22.6.1 할리우드 원칙

템플릿 메서드는 할리우드 원칙hollywood principle이라는 역전 제어 구조를 사용하는데, 높은 수준의 구성 요소가 낮은 수준의 구성 요소에 의존

할리우드 원칙을 적용해서 의존성을 설계할 때는 순환 의존성이 발생하지 않도록 주의해야 함

템플릿 메서드 패턴은 리스코프 치환 원칙The Liskov Substitution Principle, LSP도 함께 사용

<br/>

## 22.7 관련 패턴

<br/>

### 22.7.1 팩토리 메서드 패턴

팩토리 메서드 패턴은 추상화를 통해 객체의 요청과 생성을 분리함

요청과 생성을 분리할 때는 템플릿 메서드 패턴을 응용

<br/>

### 22.7.2 전략 패턴

템플릿 메서드는 상속 구조를 갖고 있음. 상위 클래스에서 먼저 큰 골격에 대한 동작의 흐름을 구현하고, 그 외의 실제적인 동작은 하위 클래스에서 구현함

템플릿 메서드에서 처리하는 템플릿은 전략 채턴에서 구현하는 알고리즘과 유사하며, 전략 패턴은 위임을 통해 알고리즘 동작을 변결함

템플릿 메서드 패턴은 알고리즘의 동작 일부를 변경하지만 전략 패턴은 알고리즘 동작 전체를 변경

<br/>

### 22.8 정리

템플릿 메서드 패턴은 공통적인 프로세스를 묶어 처리하는 패턴임

즉 일정한 프로세스가 유사한 동작을 할 때 템플릿 메서드 패턴을 적용함

템플릿 메서드는 구조를 변경하지 않고 처리 로직의 일부를 재정의하는 기법

템플릿 메서드 패턴은 추상 클래스를 이용해 공통적 기능을 추상화하고, 템플릿을 이용해 처리 로직의 상세 기능을 쉽게 확장할 수 있음

템플릿 메서드 패턴은 코드를 재사용하는 방법을 설명

템플릿 메서드는 상위 클래스에서 하위 클래스의 명령을 호출하는 후크 동작을 처리하는데, 이 후크 동작은 할리우드 원칙을 적용한 것.

템플릿 메서드 패턴은 실제 개발에서 자주 사용되는 패턴임

특히 프레임워크에서는 구조를 제어할 때 템플릿 메서드가 자주 사용되는 것을 볼 수 있음
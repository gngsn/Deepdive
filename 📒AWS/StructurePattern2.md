# Structure Pattern

<br/><br/>

## Web System

기업에서 자주 이용하는 시스템을 예로들어 AWS 서비스를 어떻게 조합하여 사용하여 설계하면 좋을지 시나리오를 통해 알아보자

<br/>

### Pattern 2. Enterprise WebSite

*목표: 조금은 더 복잡한 웹사이트의 예: 웹 서버와 DB 서버의 이중화 방법, 저비용으로 정적 콘텐츠를 배포하는 방법*

<br/>

> #### Enterprise WebSite Condition
>
>
> - 공개 사이트
> - 사용자: 거래처, 잠재적 고객, 입사지원자 등
> - 서버 다중화로 장애 대비
> - 부하가 높아지면 서버 추가 구성
> - 장애 서버의 교체, 추가는 수동으로 조작
> - 응답시간과 비용 고려

<br/>

```
#### 핵심 설계 사항

1. 웹 서버 다중화
로드밸러서로 장애에 대비, 부하가 높아진 경우에 대비해 웹 서버 추가 가능

2. DB 서버 다중화
서비스 기능을 사용해 DB 서버 복제

3. CDN과 객체 저장소를 사용한 정적 콘텐츠 전송
웹 서버로부터의 접속을 줄여 운영 비용 절감
```

<br/><br/>

기업 웹사이트의 특징: 마케팅과 커뮤니케이션 도구로 중요하게 쓰이기 때문에 (기반 업무 시스템 정도는 아니지만)안정적으로 가동되어야 한다.

<br/><img src="./img/archi2-enterprise.jpg" width="40%" /><br/>

<br/>


*구성 설명*

#### 웹 서버

가상 서버인 EC2와 가상 저장소인 EBS를 사용하여 구축, 로드밸런서를 사용하여 다중으로 구성

로드밸런서 기능을 제공하는 서비스는 ELB(Elastic Load Balancing)이다.

<br/>

#### DB 서버

RDB 관리형 서비스인 RDS(AWS Relational Database Service)로 구성. 

RDS는 셋업이 완료된 RDBMS 환경을 제공하는 서비스로 간단한 설정만으로도 다중화가 가능

이렇게 관리형 서비스들을 이용해 적은 노력으로 시스템의 구성이 가능한 것이 AWS 장점

<br/>

#### 정적 콘텐츠 전송

정적 콘텐츠 전송에 이용하는 CDN 서비스가 아마존 클라우드프론트(Amazon CloudFront)이다.

CDN은 전세계에 배치된 서버를 통해 웹 접속을 캐시하거나 분배하는 서비스로, CDN을 사용하면 응답 속도를 높이거나 웹 서버로의 접속을 줄일 수 있다.

<br/>

#### 객체 저장소 서비스 

객체 저장소 서비스는 S3(Amazon Simple Storage Service, 아마존 심플 스토리지 서비스)가 있다.

객체 저장소는 객체 단위로 데이터를 다루는 스토리지로서 REST API를 이용해 데이터의 입출력을 수행한다.

<br/><br/>

### ✔️ ELB로 웹 서버 다중화

먼저, 기본적인 세팅으로 EC2에 OS와 DML(Content Management System)를 설치한다.

웹 서버 여러 대를 구축하는데, 하나씩 설정하면 번거롭기도 하고 안정적이지 못하다.

-> 가상 서버 템플릿인 AMI를 아용해 가상 서버 여러 대를 한꺼번에 셋업하고, 동일한 구성의 EC2 인스턴스로 복제하자.


<br/><img src="./img/archi2-duplication-from-AMI.jpg" width="40%" /><br/>

<br/><br/>

필요한 수의 웹 서버를 만든 후, ELB와 연계한 다중화 구성을 설정한다. 

ELB를 웹 트래픽의 입구로 사용하여 트래픽이 복수의 웹 서버에 분산되도록 한다.

1. 인터넷 접속 엔드포인트(End Point)를 ELB로 지정한다. ELB는 IP 주소가 아닌 CNAME(대체 도메인 이름)을 지정하여 접속한다. (ELB의 IP 주소는 고정이 아니라 계속 변하기 때문) DNS 서버인 아마존 Route53을 이용해 ELB의 CNAME과 사용할 도메인 이름을 연결하면 최종적으로 도메인 이름을 통해 ELB에 접근할 수 있게 된다.
2. ELB와 웹 서버의 EC2 인스턴스를 연결시킨다. ELB 작성 페이지에 웹 서버를 선택하는 항목이 있으니까 이미 만들어진 웹 서버를 선택한다.

위의 두 과정으로 ELB에 의한 부하 분산 설정이 완료된다. ELB는 웹 서버의 부하를 감시하여 부하가 낮은 웹 서버로 요청을 분산시킨다.




<br/><br/><br/>

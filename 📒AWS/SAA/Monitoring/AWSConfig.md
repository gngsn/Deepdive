# AWS Config

- auditing, recording compliance of resources
  - AWS 내 리소스에 대한 감사와 **규정 준수**(Compliance) 여부를 기록할 수 있게 해주는 서비스
- 설정된 규칙에 기반해 **구성**과 **구성의 시간에 따른 변화를 기록**할 수 있으며 이를 통해 필요할 경우 인프라를 빠르게 롤백하고 문제점을 찾아낼 수 있음

<pre>
<b>Config로 해결할 수 있는 질문</b>
✔️ '보안 그룹에 제한되지 않은 SSH 접근이 있나?'
✔️ '버킷에 공용 액세스가 있나?'
✔️ '시간이 지나며 변화한 ALB 구성이 있나?'
</pre>

- 규칙이 규정을 준수하든 아니든 변화가 생길 때마다 SNS 알림을 받을 수 있음
- Config는 **리전별 서비스**이기 때문에 모든 리전별로 구성해야 함
- 데이터를 중앙화하기 위해 리전과 계정 간 데이터를 통합할 수 있음
- 모든 리소스의 구성을 S3에 저장해 나중에 분석할 수도 있음 (ie. Athena 같은 서버리스 쿼리 엔진)

### Rules

- AWS 관리형 Config 규칙 (75종의 규칙 제공)
- AWS Lambda를 이용해 Config 규칙 정의 가능
  - EX. 각 EBS 디스크가 gp2 유형인지 평가할 수 있고 개발 계정의 EC2 인스턴스가 t2.micro 유형인지 평가할 수도 있죠
  - 몇몇 규칙들은 구성이 변화할 때마다 평가되거나 트리거
  - EBS 디스크에 새 구성이 생길 때마다 EBS 디스크의 유형을 평가를 하거나 정기적으로 규칙이 평가되도록 트리거 (ie. 들어 2시간마다 EBS 디스크가 gp2 유형인지 평가)
- 어떤 동작을 미리 예방하지는 못함: Config 규칙은 규정 준수를 위한 것
=> **구성의 개요와 리소스의 규정 준수 여부 확인**

Config는 결제해야 하며 굉장히 비싸질 수 있습니다
- Pricing: no free tier
- $0.003 per configuration item recorded per region (각 리전당 기록된 구성 항목별로 3센트를 지불)
- $0.001 per config rule evaluation per region (리전당 Config 규칙 평가별로 0.1센트)


### Remediations

- Config 내에서 행동을 차단할 수는 없지만 SSM 자동화 문서를 이용해서 규정을 준수하지 않는 리소스를 수정할 수 있음
  - IAM 액세스 키의 만료 여부를 모니터링할 때, 키가 90일 이상 보관된 경우로 규정을 준수하지 않은 상태라면 리소스가 규정을 미준수할 때마다 수정 작업을 트리거 가능
즉, AWS 관리형 문서를 사용하든 본인만의 자동화 문서를 만들어 사용하든 규정을 준수하지 않는 리소스를 **예방은 못하되, 수정할 수 있음** (5번까지 재시도 가능)


### Notifications

- EventBridge
: 가령 보안 그룹을 모니터링하다가 규정 미준수 상태가 됐다면 EventBridge에서 이벤트를 트리거 해서 원하는 리소스에 넘길 수 있음

- SNS

한 구성 항목이 있고 특정 이벤트에만 적용되게 필터링 하고 싶다면 **SNS 필터링**을 사용해 SNS 주제를 필터링할 수 있음
- 알림 전송 (관리자 이메일, Slack 채널 등)


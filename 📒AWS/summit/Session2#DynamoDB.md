# DynamoDB

Q. 대규모 데이터를 DynamoDB로 처리하기로 결정한 이유?

## DynamoDB 역할 및 사용 사례
모든 데이터를 RDS로 할 필요가 있을까? 로 부터 시작된 DynamoDB 서비스

티어 제로 서비스: 다른 서비스가 다른 티어 위에 올릴 수 있는 서비스
EC2 박스를 사용하는 거면 

1. 규모에 따른 성능 
- 초당 수백만 개 이상의 요청을 처리
2. 서버리스
3. 엔터프라이즈에 사용 가능
- ACID 트랜잭션, 저장 중 암호화, 온디맨드 백업 및 복구 ...


**사용 트렌드**
- 운영 부담 제로
  - 글로벌 테이블을 사용해서 글로벌 서비스에서 데이터 공유 ..
- 쓰기 집약적인 워크로드
  - IoT 쓰기, 서버가 되어버리면. Thing을 모니터링 
  - 가령 만보기 같이 리워드가 필요한 서비스
  - 채팅
- 일정한 응답 시간이 필요
  - 광고
  - 세션 스토어: 디스크, 메인테넌스(버전이 있는 건 X) 관리 안되고, 밀리세컨드까지 괜찮을 때 


### 고객 사례
**디즈니 플러스**
- 글로벌 테이블을 잘 사용하는 사례
- 사용자 마다의 다른 추천 항목을 확인할 수 있는데, 이 데이터를 다이나모로 사용 중
- 리전 확장 -> 글로벌로 데이터베이스 확장이 어려운데, 클릭 한 번이 가능 했다.
- 운영 오버헤드가 거의/전혀 없다.

**드롭 박스**
- MySQL 클러스터를 빠르게 증가해야 했는데, 
- 사용 패턴을 고정에서 가변 비용으로 바꾸는 게 중요한데, 데이터베이스는 이렇게 가변적으로 변경하는 게 어려움 
- 데이터가 움직여야 하기 때문에 가변이 어려웠는데

**스냅챗**
- 피크 시간이 존재: 12월 31일 ~ 1월 1일 넘어갈 때, 모든 채팅 시간이 굉장히 어려운데, 대규모 스파이크 트래픽을 처리

**틴더**
- 설치형 몽고 DB 25TB 데이터 -> DynamoDB 
- 마이그레이션 후 60% 비용 절감


## DynamoDB의 비용 최적화 방법

> DynamoDB는 비싸다.


- 한달에 얼마 쓰는 게 중요한 게 아니고, 쓰기 / 읽기 / 스토리지 비용을 각각 얼마 정도 사용할 수 있는지 아는 게 중요하다 -> AWS Cost Explorer 사용

### 사용 최적화
**사용 최적화** -> 스키마 디자인+액세스 패턴 + 용향 모드 + 스토리지 모드
**사용 후 최적화** -> Reserved capacity

---

## 삼성 클라우드의 DynamoDB 비용 최적화 여정

전세계 대규모 서비스
- 아키텍처 (DynamoDB 규모, DynamoDB History...)
- Cost Optimization


**Samsung Cloud**
- 언제 어디서든 멀티 디바이스의 사용을 용이하게 만들고 있는 중

<< 이미지: 아키텍처 >>

키-밸류 구조 -> 한정적인 도메인이다? no
서로 다른 워크로드임에도 DynamoDB를 다양하게 사용 중
-> 스토리지 사이즈 3.5PB


### 최적화

**1. Modeling**
멀티 테이블에서 싱글 테이블로 이동
- 컴퓨팅 호스트 줄어듦
- 운영에 대한 코스트 줄어듦

하나의 엔터티 -> 하나의 테이블
????????????
고사용 테이블 + 저사용 테이블 -> 고사용에 대한 사용성 확보 가능


**2. Auto Scaling**
Provisioning mode + Auto Scaling

이슈: 스케일 관리를 위해 각 테이블 마다의 min/max 등의 설정을 개별로 설정했어야 함
실사용량 기반 사용향 기반 -> minimum default 20
TargetUtilization -> Throttling 이 발생해도 비용을 88%로 공격적 설정


**3. TTL**
Expired Item 삭제 방식을 Batch -> TTL 로 변경 <== 90% 절감

- WCU 사용량이 많을 수밖에 없었는데 스토리지, RCU, WCU 극적으로 감소


**4. Reserved Capacity**
4-1. 수집: 리전 별 최근 3~6개월 간 사용량 수집
4-2. 예측: 1년 총 사용량 예측
4-3. 산정: 리전별 구매 비율 산정


**5. Standard-IA**
비용 분석 / 테이블 클래스 변경


*어떤 테이블 클래스가 가장 비용 효율적일지 생각해 볼만하다.*


## AWS 전문가들과 함께 DynamoDB 시작하기

- DynamoDB Immersion Day 
- DCAD(Database Clinic in A Day)










